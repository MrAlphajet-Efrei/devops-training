# Story 1.4: React/Next.js Frontend Service

## Status

**Ready for Review**

---

## Story

**As a** DevOps engineer,
**I want** a simple React/Next.js frontend that calls the API,
**so that** I have a complete 3-tier application to deploy.

---

## Acceptance Criteria

1. Next.js application is created in `apps/frontend/`
2. Homepage displays data fetched from the API `/items` endpoint
3. Environment variable configures API URL (`NEXT_PUBLIC_API_URL`)
4. Application runs locally with `npm run dev` on port 3000
5. Basic styling is applied (minimal, portfolio-presentable)
6. `README.md` documents how to run the frontend locally

---

## Tasks / Subtasks

- [x] **Task 1: Initialize Next.js Project** (AC: 1, 4)
  - [x] Create `apps/frontend/` directory
  - [x] Initialize Next.js 16 with TypeScript (`npx create-next-app@latest`)
  - [x] Enable App Router (default in Next.js 16)
  - [x] Configure Tailwind CSS
  - [x] Remove boilerplate/example content
  - [x] Verify `npm run dev` starts on port 3000

- [x] **Task 2: Set Up Project Structure** (AC: 1)
  - [x] Create `src/components/` directory
  - [x] Create `src/components/ui/` for generic components
  - [x] Create `src/components/items/` for feature components
  - [x] Create `src/components/layout/` for layout components
  - [x] Create `src/hooks/` directory
  - [x] Create `src/services/` directory
  - [x] Create `src/types/` directory
  - [x] Create `src/lib/` directory for utilities

- [x] **Task 3: Configure Environment Variables** (AC: 3)
  - [x] Create `.env.local.example` template
  - [x] Add `NEXT_PUBLIC_API_URL` variable
  - [x] Document environment variable in README
  - [x] Add `.env.local` to `.gitignore`

- [x] **Task 4: Create API Client Service** (AC: 2)
  - [x] Create `src/services/api.ts` with base client
  - [x] Implement `apiClient<T>()` generic function
  - [x] Handle API errors gracefully
  - [x] Create `src/services/items.ts` for items API
  - [x] Implement `list()`, `create()`, `getById()` methods

- [x] **Task 5: Create TypeScript Types** (AC: 2)
  - [x] Create `src/types/item.ts`
  - [x] Define `Item` interface
  - [x] Define `CreateItemRequest` interface
  - [x] Define `ItemListResponse` interface

- [x] **Task 6: Create SWR Hook for Items** (AC: 2)
  - [x] Install SWR dependency (`npm install swr`)
  - [x] Create `src/hooks/useItems.ts`
  - [x] Implement `useItems()` hook with SWR
  - [x] Return items, isLoading, isError, refresh

- [x] **Task 7: Create UI Components** (AC: 2, 5)
  - [x] Create `src/components/ui/Card.tsx`
  - [x] Create `src/components/items/ItemCard.tsx`
  - [x] Create `src/components/items/ItemList.tsx`
  - [x] Create `src/components/layout/Header.tsx`
  - [x] Apply Tailwind CSS styling

- [x] **Task 8: Build Homepage** (AC: 2, 5)
  - [x] Update `src/app/page.tsx`
  - [x] Add Header component
  - [x] Add ItemList component
  - [x] Display loading state
  - [x] Display error state
  - [x] Style for portfolio presentation

- [x] **Task 9: Create Frontend README** (AC: 6)
  - [x] Document project overview
  - [x] Document prerequisites (Node.js 18+, npm)
  - [x] Document installation steps
  - [x] Document environment variables
  - [x] Document how to run locally
  - [x] Document available scripts

---

## Dev Notes

### Relevant Source Tree

```
apps/frontend/
├── src/
│   ├── app/                    # Next.js App Router
│   │   ├── layout.tsx          # Root layout
│   │   ├── page.tsx            # Homepage
│   │   ├── loading.tsx         # Loading state
│   │   └── error.tsx           # Error boundary
│   ├── components/
│   │   ├── ui/                 # Generic UI components
│   │   │   └── Card.tsx
│   │   ├── items/              # Feature components
│   │   │   ├── ItemCard.tsx
│   │   │   └── ItemList.tsx
│   │   └── layout/             # Layout components
│   │       └── Header.tsx
│   ├── hooks/                  # Custom React hooks
│   │   └── useItems.ts
│   ├── services/               # API client layer
│   │   ├── api.ts
│   │   └── items.ts
│   ├── types/                  # TypeScript types
│   │   └── item.ts
│   └── lib/                    # Utilities
├── public/
├── .env.local.example
├── package.json
├── tailwind.config.ts
├── tsconfig.json
└── README.md
```

### API Client Pattern

```typescript
// src/services/api.ts
const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || "http://localhost:8000";

export async function apiClient<T>(
  endpoint: string,
  options: RequestInit = {},
): Promise<T> {
  const response = await fetch(`${API_BASE_URL}${endpoint}`, {
    headers: {
      "Content-Type": "application/json",
      ...options.headers,
    },
    ...options,
  });

  if (!response.ok) {
    throw new Error(`API error: ${response.status}`);
  }

  return response.json();
}
```

### Items Service Pattern

```typescript
// src/services/items.ts
import { apiClient } from "./api";
import type { Item, ItemListResponse, CreateItemRequest } from "@/types/item";

export const itemsService = {
  list: () => apiClient<ItemListResponse>("/items"),
  getById: (id: string) => apiClient<Item>(`/items/${id}`),
  create: (data: CreateItemRequest) =>
    apiClient<Item>("/items", {
      method: "POST",
      body: JSON.stringify(data),
    }),
};
```

### SWR Hook Pattern

```typescript
// src/hooks/useItems.ts
import useSWR from "swr";
import { itemsService } from "@/services/items";

export function useItems() {
  const { data, error, isLoading, mutate } = useSWR("/items", () =>
    itemsService.list(),
  );

  return {
    items: data?.items ?? [],
    total: data?.total ?? 0,
    isLoading,
    isError: !!error,
    refresh: mutate,
  };
}
```

### TypeScript Types

```typescript
// src/types/item.ts
export interface Item {
  id: string;
  name: string;
  description?: string;
  createdAt: string;
  updatedAt: string;
}

export interface CreateItemRequest {
  name: string;
  description?: string;
}

export interface ItemListResponse {
  items: Item[];
  total: number;
}
```

### Tech Stack for This Story

| Technology   | Version | Purpose               |
| ------------ | ------- | --------------------- |
| Next.js      | 16.x    | React framework       |
| TypeScript   | 5.x     | Type safety           |
| Tailwind CSS | 4.x     | Styling               |
| SWR          | 2.x     | Data fetching/caching |
| React        | 19.x    | UI library            |

### Environment Variables

| Variable              | Example                 | Description     |
| --------------------- | ----------------------- | --------------- |
| `NEXT_PUBLIC_API_URL` | `http://localhost:8000` | Backend API URL |

### Naming Conventions

| Element    | Convention                  | Example            |
| ---------- | --------------------------- | ------------------ |
| Components | PascalCase                  | `ItemCard.tsx`     |
| Hooks      | camelCase with `use` prefix | `useItems.ts`      |
| Services   | camelCase                   | `itemsService`     |
| Types      | PascalCase                  | `ItemListResponse` |

### Dependencies on Previous Stories

- **Story 1.1**: Project structure must exist
- **Story 1.3**: API endpoints for `/items` must be available

### Key Constraints

- **Type Safety**: TypeScript strict mode
- **API Calls**: Use service layer, never direct fetch in components
- **Environment Variables**: Access through `process.env` only
- **Styling**: Tailwind CSS utility classes

### Important Implementation Notes

1. API URL defaults to localhost:8000 for development
2. SWR handles caching and revalidation automatically
3. Keep components simple - this is a portfolio demo
4. Error boundaries catch and display errors gracefully
5. Loading states improve user experience

---

## Testing

### Testing Requirements

| Test Type   | Coverage Target   | Framework                        |
| ----------- | ----------------- | -------------------------------- |
| Unit Tests  | Components render | Jest + React Testing Library     |
| Integration | API calls work    | Jest + MSW (mock service worker) |

### Test Scenarios

1. **test_item_card_renders_name** - ItemCard displays item name
2. **test_item_list_shows_loading** - ItemList shows loading state
3. **test_item_list_shows_items** - ItemList renders items from API
4. **test_item_list_shows_error** - ItemList handles API errors

### Test Commands

```bash
cd apps/frontend

# Run tests
npm test

# Run tests in watch mode
npm test -- --watch

# Run with coverage
npm test -- --coverage
```

---

## Change Log

| Date       | Version | Description         | Author |
| ---------- | ------- | ------------------- | ------ |
| 2025-01-26 | 1.0     | Initial story draft | SM Bob |
| 2026-01-27 | 1.1     | Updated to Next.js 16, React 19, Tailwind 4 | Dev James |
| 2026-01-27 | 1.2     | Implementation complete - all 9 tasks done | Dev James |

---

## Dev Agent Record

### Agent Model Used

Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References

No issues encountered during implementation.

### Completion Notes List

- Upgraded from Next.js 15 (story spec) to Next.js 16.1.5 (latest stable) with React 19.2.3
- Tailwind CSS 4 used (v4 ships with Next.js 16 via `@tailwindcss/postcss`)
- React Compiler enabled (stable in Next.js 16)
- Turbopack used by default for dev and build
- `.gitignore` updated to exclude `.env*` but include `.env.local.example`
- Added `loading.tsx` and `error.tsx` app-level boundary files per source tree spec
- ESLint passes clean, production build succeeds
- All 7 tests pass (3 ItemCard + 4 ItemList)
- Jest 30 + ts-jest + React Testing Library configured
- SWR 2.3.8 installed as runtime dependency

### File List

- `apps/frontend/package.json` (new)
- `apps/frontend/tsconfig.json` (new)
- `apps/frontend/next.config.ts` (new)
- `apps/frontend/postcss.config.mjs` (new)
- `apps/frontend/.gitignore` (new, modified)
- `apps/frontend/.env.local.example` (new)
- `apps/frontend/README.md` (new)
- `apps/frontend/src/app/layout.tsx` (new, modified)
- `apps/frontend/src/app/page.tsx` (new, modified)
- `apps/frontend/src/app/globals.css` (new)
- `apps/frontend/src/app/loading.tsx` (new)
- `apps/frontend/src/app/error.tsx` (new)
- `apps/frontend/src/types/item.ts` (new)
- `apps/frontend/src/services/api.ts` (new)
- `apps/frontend/src/services/items.ts` (new)
- `apps/frontend/src/hooks/useItems.ts` (new)
- `apps/frontend/src/components/ui/Card.tsx` (new)
- `apps/frontend/src/components/items/ItemCard.tsx` (new)
- `apps/frontend/src/components/items/ItemList.tsx` (new)
- `apps/frontend/src/components/layout/Header.tsx` (new)
- `apps/frontend/src/components/items/__tests__/ItemCard.test.tsx` (new)
- `apps/frontend/src/components/items/__tests__/ItemList.test.tsx` (new)
- `apps/frontend/jest.config.js` (new)
- `apps/frontend/jest.setup.ts` (new)

---

## QA Results

### Review Date: 2026-01-27

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

Well-structured Next.js 16 application with clean component hierarchy (layout → items → ui), proper service layer abstraction, and TypeScript strict mode. SWR hook correctly abstracts data fetching with loading/error/empty states. Tailwind CSS styling is clean with dark mode support. Error boundary and loading boundary at app level demonstrate production awareness.

**Critical finding**: The frontend TypeScript `Item` type uses camelCase fields (`createdAt`, `updatedAt`) but the FastAPI backend serializes with snake_case (`created_at`, `updated_at`). This means date fields will be `undefined` on the frontend, and `new Date(item.createdAt).toLocaleDateString()` in `ItemCard.tsx` will render "Invalid Date".

### Refactoring Performed

None — no code changes made during this review (advisory only per project guidelines).

### Compliance Check

- Coding Standards: ✓ — TypeScript strict, PascalCase components, camelCase hooks, service layer pattern
- Project Structure: ✓ — Follows `apps/frontend/src/` layout from unified project structure
- Testing Strategy: ✓ — 7 tests covering component rendering, loading, error, and empty states
- All ACs Met: ✗ — AC2 partially broken due to field name mismatch (items display, but dates show "Invalid Date")

### Improvements Checklist

- [ ] **HIGH**: Fix camelCase/snake_case mismatch between frontend `Item` type (`createdAt`/`updatedAt`) and backend JSON response (`created_at`/`updated_at`). Options: (a) add a response transformer in `apiClient`, (b) change frontend types to snake_case, or (c) configure FastAPI to serialize with camelCase alias
- [ ] **LOW**: `error.tsx` exposes `error.message` to users — could leak internal details in production (acceptable for portfolio demo)
- [ ] **LOW**: Frontend `.dockerignore` does not exclude `__tests__/` directories from build context (no runtime impact, but increases context size)
- [ ] **LOW**: Add `npm test -- --coverage` to CI documentation for coverage tracking

### Security Review

No security concerns. No secrets in client-side code. API URL configured via environment variable with safe localhost fallback. No user input is sent to APIs without type validation via TypeScript interfaces.

### Performance Considerations

SWR provides automatic caching and revalidation. Next.js standalone output configured for Docker optimization. React Compiler enabled for automatic memoization. No performance concerns identified.

### Files Modified During Review

None.

### Gate Status

Gate: CONCERNS → docs/qa/gates/1.4-react-nextjs-frontend.yml

### Recommended Status

✗ Changes Required — The snake_case/camelCase field mismatch (HIGH) will cause "Invalid Date" display on the homepage. Core item listing works (name, description), but dates are broken, partially failing AC2. Fix the type mapping before marking as Done.
